//>>built
define("dojox/form/uploader/_HTML5","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo dojo/request dojo/request/xhr dojo/has".split(" "),function(l,p,m,d,n,e,g){function h(){}g("native-xhr2")&&(e._create=function(a){return function(){var b=a();b.upload.addEventListener("progress",h,!1);return b}}(e._create));return l("dojox.form.uploader._HTML5",[],{errMsg:"Error uploading files. Try checking permissions",uploadType:"html5",postMixInProperties:function(){this.inherited(arguments)},postCreate:function(){this.connectForm();
this.inherited(arguments);this.uploadOnSelect&&this.connect(this,"onChange",function(a){this.upload(a[0])})},_drop:function(a){d.stopEvent(a);this._files=a.dataTransfer.files;this.onChange(this.getFileList())},upload:function(a){this.onBegin(this.getFileList());this.uploadWithFormData(a)},addDropTarget:function(a,b){b||(this.connect(a,"dragenter",d.stopEvent),this.connect(a,"dragover",d.stopEvent),this.connect(a,"dragleave",d.stopEvent));this.connect(a,"drop","_drop")},uploadWithFormData:function(a){function b(a){f._xhrProgress(a);
"load"===a.type&&(f.onComplete(c.response.data),c.response.xhr.removeEventListener("load",b,!1),c.response.xhr.upload.removeEventListener("progress",b,!1),c.response.xhr.upload.removeEventListener("progress",h,!1),c=null)}if(this.getUrl()){var d=new FormData,e=this._getFileFieldName();m.forEach(this._files,function(a,b){d.append(e,a)},this);if(a){a.uploadType=this.uploadType;for(var k in a)d.append(k,a[k])}var f=this,c=n(this.getUrl(),{method:"POST",data:d,handleAs:"json",headers:{Accept:"application/json"}},
!0);c.promise.response.otherwise(function(a){console.error(a);console.error(a.response.text);f.onError(a)});g("native-xhr2")?(c.response.xhr.addEventListener("load",b,!1),c.response.xhr.upload.addEventListener("progress",b,!1)):c.promise.then(function(a){f.onComplete(a)})}else console.error("No upload url found.",this)},_xhrProgress:function(a){if(a.lengthComputable){var b={bytesLoaded:a.loaded,bytesTotal:a.total,type:a.type,timeStamp:a.timeStamp};"load"==a.type?(b.percent="100%",b.decimal=1):(b.decimal=
a.loaded/a.total,b.percent=Math.ceil(a.loaded/a.total*100)+"%");this.onProgress(b)}}})});
//# sourceMappingURL=_HTML5.js.map